# Stage 1: Build the React frontend
FROM node:16 AS frontend-builder

WORKDIR /app

COPY frontend/package.json frontend/package-lock.json ./
RUN npm install

COPY frontend/ ./
RUN npm run build

# Stage 2: Set up the Flask backend
FROM python:3.9

WORKDIR /app

# Copy backend files
COPY backend/ /app/backend/
COPY backend/requirement.txt /app/requirement.txt

# Install Python dependencies
RUN pip install -r /app/requirement.txt

# Copy frontend build files
COPY --from=frontend-builder /app/build /app/build

# Set environment variables
ENV FLASK_APP=backend/wsgi.py
ENV FLASK_RUN_HOST=0.0.0.0

# Expose the port the app runs on
EXPOSE 5000

# Command to run the Flask server
CMD ["flask", "run"]
